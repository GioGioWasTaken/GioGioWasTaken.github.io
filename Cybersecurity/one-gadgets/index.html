<!doctype html><html data-theme=dark lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#9ac2c2 name=theme-color><title>One Gadgets - Gio's site</title><link href=https://giogiowastaken.github.io/Cybersecurity/one-gadgets/ rel=canonical><link href=https://giogiowastaken.github.io/favicon.png rel=icon type=image/png><link href=https://giogiowastaken.github.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><style>:root{--accent-color:#9ac2c2}</style><link href=https://giogiowastaken.github.io/style.css rel=stylesheet><script defer src=https://giogiowastaken.github.io/closable.js></script><meta content="Gio's site" property=og:site_name><meta content="One Gadgets - Gio's site" property=og:title><meta content=https://giogiowastaken.github.io/Cybersecurity/one-gadgets/ property=og:url><meta property=og:description><meta content=https://giogiowastaken.github.io/card.png property=og:image><meta content=en_US property=og:locale><body><main id=main-content><h1>One Gadgets</h1><h1 id=finding-one-gadgets>Finding one gadgets</h1><p>If one_gadget and Angry_gadget both fail to find one_gadgets, we can look for them manually. Here's an example of how:<pre class=language-bash data-lang=bash style=color:#c0c5ce;background-color:#2b303b><code class=language-bash data-lang=bash><span style=color:#bf616a>virtual@mecha:~$</span><span> ldd buf64 | </span><span style=color:#bf616a>grep</span><span> libc
</span><span style=color:#bf616a>libc.so.6</span><span> => /lib/x86_64-linux-gnu/libc.so.6 (0x00007ffff77f3000)
</span><span style=color:#bf616a>virtual@mecha:~$</span><span> strings</span><span style=color:#bf616a> -tx</span><span> /lib/x86_64-linux-gnu/libc.so.6 | </span><span style=color:#bf616a>grep</span><span> /bin/sh
</span><span style=color:#bf616a>1a3f20</span><span> /bin/sh
</span><span style=color:#bf616a>virtual@mecha:~$</span><span> objdump</span><span style=color:#bf616a> -M</span><span> intel</span><span style=color:#bf616a> -d</span><span> /lib/x86_64-linux-gnu/libc.so.6 | </span><span style=color:#bf616a>grep</span><span> execve</span><span style=color:#bf616a> -B5 </span><span>| </span><span style=color:#bf616a>grep</span><span> rdi</span><span style=color:#bf616a> -C3 </span><span>| </span><span style=color:#bf616a>grep</span><span> 1a3f20</span><span style=color:#bf616a> -C3
</span><span style=color:#bf616a>--
</span><span>   </span><span style=color:#bf616a>d975a:</span><span> 49 8d 7d 10           lea    rdi,</span><span style=color:#b48ead>[</span><span>r13+0x10</span><span style=color:#b48ead>]
</span><span>   </span><span style=color:#bf616a>d975e:</span><span> e8 4d 6f f4 ff        call   206b0 <*ABS*+0x953c0@plt>
</span><span>   </span><span style=color:#bf616a>d9763:</span><span> 48 8d 3d b6 a7 0c 00  lea    rdi,</span><span style=color:#b48ead>[</span><span>rip+0xca7b6</span><span style=color:#b48ead>]        </span><span style=color:#65737e># 1a3f20 <_libc_intl_domainname@@GLIBC_2.2.5+0x186>
</span><span>   </span><span style=color:#bf616a>d976a:</span><span> 48 89 da              mov    rdx,rbx
</span><span>   </span><span style=color:#bf616a>d976d:</span><span> 4c 89 ee              mov    rsi,r13
</span><span>   </span><span style=color:#bf616a>d9770:</span><span> e8 8b f8 ff ff        call   d9000 &LTexecve@@GLIBC_2.2.5>
</span><span style=color:#bf616a>--
</span><span>   </span><span style=color:#bf616a>d9a2c:</span><span> e8 7f 6c f4 ff        call   206b0 <*ABS*+0x953c0@plt>
</span><span>   </span><span style=color:#bf616a>d9a31:</span><span> 48 8b 8d 60 ff ff ff  mov    rcx,QWORD PTR </span><span style=color:#b48ead>[</span><span>rbp-0xa0</span><span style=color:#b48ead>]
</span><span>   </span><span style=color:#bf616a>d9a38:</span><span> 48 8b 55 90           mov    rdx,QWORD PTR </span><span style=color:#b48ead>[</span><span>rbp-0x70</span><span style=color:#b48ead>]
</span><span>   =</span><span style=color:#a3be8c>=</span><span>>d9a3c: </span><span style=color:#bf616a>48</span><span> 8d 3d dd a4 0c 00  lea    rdi,</span><span style=color:#b48ead>[</span><span>rip+0xca4dd</span><span style=color:#b48ead>]        </span><span style=color:#65737e># 1a3f20 <_libc_intl_domainname@@GLIBC_2.2.5+0x186>
</span><span>   </span><span style=color:#bf616a>d9a43:</span><span> 48 89 ce              mov    rsi,rcx
</span><span>   </span><span style=color:#bf616a>d9a46:</span><span> e8 b5 f5 ff ff        call   d9000 &LTexecve@@GLIBC_2.2.5>
</span><span style=color:#bf616a>--
</span><span>   </span><span style=color:#bf616a>fccd9:</span><span> e8 52 7b 00 00        call   104830 <__close@@GLIBC_2.2.5>
</span><span>   =</span><span style=color:#a3be8c>=</span><span>>fccde: </span><span style=color:#bf616a>48</span><span> 8b 05 c3 d1 2d 00  mov    rax,QWORD PTR </span><span style=color:#b48ead>[</span><span>rip+0x2dd1c3</span><span style=color:#b48ead>]        </span><span style=color:#65737e># 3d9ea8 <__environ@@GLIBC_2.2.5-0x31b0>
</span><span>   </span><span style=color:#bf616a>fcce5:</span><span> 48 8d 74 24 40        lea    rsi,</span><span style=color:#b48ead>[</span><span>rsp+0x40</span><span style=color:#b48ead>]
</span><span>   </span><span style=color:#bf616a>fccea:</span><span> 48 8d 3d 2f 72 0a 00  lea    rdi,</span><span style=color:#b48ead>[</span><span>rip+0xa722f</span><span style=color:#b48ead>]        </span><span style=color:#65737e># 1a3f20 <_libc_intl_domainname@@GLIBC_2.2.5+0x186>
</span><span>   </span><span style=color:#bf616a>fccf1:</span><span> 48 8b 10              mov    rdx,QWORD PTR </span><span style=color:#b48ead>[</span><span>rax</span><span style=color:#b48ead>]
</span><span>   </span><span style=color:#bf616a>fccf4:</span><span> e8 07 c3 fd ff        call   d9000 &LTexecve@@GLIBC_2.2.5>
</span><span style=color:#bf616a>--
</span><span>   </span><span style=color:#bf616a>fdb89:</span><span> e8 a2 6c 00 00        call   104830 <__close@@GLIBC_2.2.5>
</span><span>   =</span><span style=color:#a3be8c>=</span><span>>fdb8e: </span><span style=color:#bf616a>48</span><span> 8b 05 13 c3 2d 00  mov    rax,QWORD PTR </span><span style=color:#b48ead>[</span><span>rip+0x2dc313</span><span style=color:#b48ead>]        </span><span style=color:#65737e># 3d9ea8 <__environ@@GLIBC_2.2.5-0x31b0>
</span><span>   </span><span style=color:#bf616a>fdb95:</span><span> 48 8d 74 24 70        lea    rsi,</span><span style=color:#b48ead>[</span><span>rsp+0x70</span><span style=color:#b48ead>]
</span><span>   </span><span style=color:#bf616a>fdb9a:</span><span> 48 8d 3d 7f 63 0a 00  lea    rdi,</span><span style=color:#b48ead>[</span><span>rip+0xa637f</span><span style=color:#b48ead>]        </span><span style=color:#65737e># 1a3f20 <_libc_intl_domainname@@GLIBC_2.2.5+0x186>
</span><span>   </span><span style=color:#bf616a>fdba1:</span><span> 48 8b 10              mov    rdx,QWORD PTR </span><span style=color:#b48ead>[</span><span>rax</span><span style=color:#b48ead>]
</span><span>   </span><span style=color:#bf616a>fdba4:</span><span> e8 57 b4 fd ff        call   d9000 &LTexecve@@GLIBC_2.2.5>
</span></code></pre><p>What did he do here? 1. Found offset of <code>/bin/sh</code> string. 2. Disassembled libc and found all <code>execve</code> calls and printed 5 instructions before it. 3. Piped that output and found <code>rdi</code> string and 3 instructions before and after it. 4. Piped that output and found refrences of <code>/bin/sh</code> string location.</main><footer id=site-footer></footer>